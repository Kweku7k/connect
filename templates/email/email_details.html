{% extends "layout.html" %}

{% block body %}
<div class="container">

  <div class="flexBar" style="margin:3vh 0;">
    <div >
      <h4>Email Templates Details</h4>
      <!-- <h6 class="text-muted">{{groupCount}} groups</h6> -->
  </div>

  <a href="{{url_for(previewLink, id=previewLinkId)}}">
    <button data-bs-toggle="modal" data-bs-target="#staticBackdrop" class="pill-button">Preview</button>
  </a>
</div>

  <div class="row">
      <div class="col-md-6">
        <div class="defaultCard">
            <form action="" method="post">
                {{form.hidden_tag()}}
                <h6>Send a quick email to your group</h6>

                <div class="row">
                    <div class="col">
                        <div class="inputTextHolder">
                            <h6>{{form.templateid.label}}</h6>
                            {{form.templateid (class="inputTextCard", placeholder="Enter your message.")}}
                            {% for error in form.templateid.errors %}
                            <h6 style="color: red; font-weight: 100;">{{error}}</h6>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="col">

                        <div class="inputTextHolder">
                            <h6>{{form.group.label}}</h6>
                            {{form.group (class="inputTextCard", placeholder="Enter your message.")}}
                            {% for error in form.group.errors %}
                            <h6 style="color: red; font-weight: 100;">{{error}}</h6>
                            {% endfor %}
                        </div>
                    </div>

                </div>

                <div class="inputTextHolder">
                    <h6>{{form.title.label}}</h6>
                    {{form.title (class="inputTextCard", placeholder="Enter your message.")}}
                    {% for error in form.title.errors %}
                    <h6 style="color: red; font-weight: 100;">{{error}}</h6>
                    {% endfor %}
                </div>
                
                <div class="inputTextHolder">
                    <h6>{{ form.allpostId.label }}</h6>
                    {{ form.allpostId(class="inputTextCard", id="allpostIdInput", placeholder="Enter your message.") }}
                    {% for error in form.allpostId.errors %}
                        <h6 style="color: red; font-weight: 100;">{{ error }}</h6>
                    {% endfor %}
                </div>

                <div class="inputTextHolder">
                    <h6>{{form.subject.label}}</h6>
                    {{form.subject (class="inputTextCard", placeholder="Enter your message.")}}
                    {% for error in form.subject.errors %}
                    <h6 style="color: red; font-weight: 100;">{{error}}</h6>
                    {% endfor %}
                </div>

                <div class="inputTextHolder">
                    <h6>{{form.message.label}}</h6>
                    {{form.message (class="inputTextCard", placeholder="Enter your message.")}}
                    {% for error in form.message.errors %}
                    <h6 style="color: red; font-weight: 100;">{{error}}</h6>
                    {% endfor %}
                </div>
                

            </br>
                {{form.submit (class="pill-button", style="width:100%", onclick="showLoadingScreen()")}}
            </form>
        </div>
      </div>

      <div class="col-md-6">
        <div class="defaultCard">
            <form action="" method="post">
                {{form.hidden_tag()}}
                <h6>Send a quick email to your group</h6>

                <div class="inputTextHolder">
                    <div class="row align-items-center">
                        <div class="col-md-10">
                            <div class="form-group">
                              <label for="">Post Id</label>
                              <input type="text"
                                class="form-control inputTextCard" id="wpurlinput" name="" id="" aria-describedby="helpId" placeholder="">
                            </div>
                        </div>
                        <div class="col-md-2 d-flex justify-content-end align-items-end">
                            <a id="addButton" class="btn btn-primary" href="#" role="button">Add</a>
                        </div>
                    </div>
                
                    <div id="cardContainer" class="card-body mt-3">
                        <!-- New cards will be appended here -->
                    </div>
                </div>
                
                
        
            </form>
        </div>
      </div>
  </div>
  </div>


<script>
    document.getElementById('addButton').addEventListener('click', function(event) {
        event.preventDefault(); // Prevent page reload
    
        // Get the WordPress Post URL entered by the user
        let postUrl = document.getElementById('wpurlinput').value;
    
        // Extract the Post ID (assuming it's the last part of the URL)
        let postId = postUrl.split('/').filter(Boolean).pop();
    
        if (postId) {
            // Retrieve any existing Post IDs from sessionStorage
            let storedPostIds = JSON.parse(sessionStorage.getItem('postIds')) || [];
    
            // Add the new postId to the array
            storedPostIds.push(postId);
    
            // Save the updated array back to sessionStorage
            sessionStorage.setItem('postIds', JSON.stringify(storedPostIds));
    
            // Update the allpostId input field with the new list of Post IDs
            document.getElementById('allpostIdInput').value = storedPostIds.join(', ');
    
            addCard(postId); // Optional: add the card to the card container
            
        } else {
            alert("Invalid URL or Post ID not found.");
        }
    });
    
    function addCard(postId) {
        const cardContainer = document.getElementById('cardContainer');
    
        // Create new card div
        const newCard = document.createElement('div');
        newCard.className = '';
    
        newCard.innerHTML = `
            <div class="card-body" style="padding: 10px;">
                <div class="d-flex justify-content-between align-items-center">
                    <p class="card-text mb-0" style="flex: 1;">Post ID: ${postId}</p>
                    <button class="btn btn-danger btn-sm delete-button" data-id="${postId}">
                        <i class="fas fa-trash-alt"></i> Delete
                    </button>
                </div>
            </div>
        `;
    
        // Append the new card to the container
        cardContainer.appendChild(newCard);
    
        newCard.querySelector('.delete-button').addEventListener('click', function() {
            removeCard(postId, newCard);
        });
    }
    
    function removeCard(postId, cardElement) {
        // Remove the card from the DOM
        cardElement.remove();
    
        // Remove the postId from sessionStorage
        let storedPostIds = JSON.parse(sessionStorage.getItem('postIds')) || [];
        storedPostIds = storedPostIds.filter(id => id !== postId);
        sessionStorage.setItem('postIds', JSON.stringify(storedPostIds));
    
        // Update the allpostId input field
        document.getElementById('allpostIdInput').value = storedPostIds.join(', ');
    
        alert(`Post ID ${postId} removed from local storage!`);
    }
</script>
{% endblock %}
